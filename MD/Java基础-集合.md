[toc]

## HashMap

### 1. HashMap是什么？它是如何工作的？

HashMap是Java中的一个集合类，用于存储键值对。它基于哈希表实现，使用哈希算法来计算键的哈希码，然后将键值对存储在哈希表的对应位置。当需要查找键值对时，HashMap会使用相同的哈希算法计算键的哈希码，并在哈希表中查找对应位置的键值对。

### 2. HashMap的容量是如何确定的？

HashMap的容量是在创建HashMap对象时指定的。它会根据指定的初始容量和负载因子来确定哈希表的大小。负载因子是一个浮点数，表示哈希表的填充比例。当哈希表中的键值对数量超过负载因子乘以容量时，哈希表会自动进行扩容，以保证哈希表的性能。

### 3. HashMap的实现原理是什么？

HashMap的实现原理基于哈希表，它使用哈希算法来计算键的哈希码，并将键值对存储在哈希表的对应位置。当需要查找键值对时，HashMap会使用相同的哈希算法计算键的哈希码，并在哈希表中查找对应位置的键值对。如果有多个键值对存储在同一个位置，HashMap会使用链表或红黑树等数据结构来存储这些键值对，以提高查找效率。

### 4. HashMap和Hashtable有什么区别？

HashMap和Hashtable都是用于存储键值对的集合类，但它们有以下区别：

- HashMap是非线程安全的，而Hashtable是线程安全的。
- HashMap允许键和值为null，而Hashtable不允许。
- HashMap的迭代器是fail-fast的，而Hashtable的迭代器不是。
- HashMap是JDK 1.2引入的，而Hashtable是JDK 1.0引入的，已经被废弃了。

### 5. 如何避免HashMap中的冲突？

为了避免HashMap中的冲突，可以使用以下方法：

- 选择合适的初始容量和负载因子。
- 实现hashCode()方法和equals()方法，以确保键的唯一性。
- 尽量避免使用可变对象作为键。
- 在并发环境下，可以考虑使用ConcurrentHashMap等线程安全的集合类。

### 6. 为什么hashmap线程不安全?

HashMap是线程不安全的主要原因是它的内部结构是基于哈希表实现的，并且没有进行同步措施来保证多线程环境下的安全性。具体原因如下：

1. 并发修改导致的数据不一致：当多个线程同时对HashMap进行修改操作时，可能会导致数据不一致的情况。例如，一个线程正在进行扩容操作，而另一个线程同时进行插入操作，可能会导致某些键值对丢失或者重复插入。

2. 链表环形引用导致的死循环：在JDK 1.7及之前的版本中，当哈希表中的链表长度达到一定阈值时，会将链表转换为红黑树来提高查找效率。但是，在多线程环境下，如果两个线程同时对同一个链表进行插入操作，可能会导致链表中的节点形成环形引用，从而导致死循环。

3. 不正确的迭代器使用：HashMap的迭代器是fail-fast的，即在迭代过程中如果有其他线程对HashMap进行修改操作，会抛出ConcurrentModificationException异常。这是因为迭代器在创建时会记录一个modCount值，表示HashMap的修改次数。当迭代器进行next操作时，会检查modCount值是否发生变化，如果发生变化则抛出异常。但是，如果在迭代过程中有其他线程对HashMap进行修改操作，可能会导致modCount值发生变化，从而导致迭代器抛出异常。

为了在多线程环境下安全地使用HashMap，可以考虑使用线程安全的ConcurrentHashMap或者使用同步措施来保证HashMap的安全性，例如使用Collections.synchronizedMap方法包装HashMap，或者使用锁来对HashMap进行同步操作。

### 7. hashmap里，什么是散列分布均匀，为什么要散列分布均匀?
散列分布均匀是指在哈希表中，键的哈希码被均匀地分布在不同的位置上。也就是说，尽量避免多个键的哈希码映射到同一个位置上，以减少哈希冲突的概率。

散列分布均匀的好处是可以提高哈希表的性能。当键的哈希码均匀地分布在不同的位置上时，查找键值对的时间复杂度可以接近O(1)，因为只需要计算键的哈希码并在哈希表中查找对应位置的键值对。而如果多个键的哈希码映射到同一个位置上，就需要遍历链表或红黑树等数据结构来查找键值对，时间复杂度可能会变为O(n)。

为了实现散列分布均匀，可以采取以下措施：

1. 选择合适的初始容量和负载因子：初始容量和负载因子可以影响哈希表的填充比例。当哈希表的填充比例适中时，可以减少哈希冲突的概率。

2. 实现hashCode()方法：hashCode()方法用于计算键的哈希码。应该尽量保证hashCode()方法返回的哈希码分布均匀，避免多个键的哈希码映射到同一个位置上。

3. 使用好的哈希函数：哈希函数可以将键的哈希码映射到哈希表的位置。选择好的哈希函数可以减少哈希冲突的概率，提高散列分布的均匀性。

通过以上措施，可以尽量保证哈希表中键的哈希码分布均匀，减少哈希冲突的概率，从而提高哈希表的性能。